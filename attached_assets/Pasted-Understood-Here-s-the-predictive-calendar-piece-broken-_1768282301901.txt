Understood. Here’s the “predictive calendar” piece broken into (1) algorithms you can implement and (2) the exact data files to upload so the model has something real to learn from.

If the app is “being a dumb bitch,” it’s because it’s guessing without a strict mapping + strict constraints. This fixes that.

---

## 1) Algorithms for a predictive/probability schedule (works with Golden Rule budgets + 15-min grid)

### A. Normalize everything to a 15-minute grid (non-negotiable)

Represent the schedule as discrete slots so drag/drop and prediction behave the same way.

* Day runs: **06:30 → 15:30**
* Slot size: **15 minutes**
* Slots per day: `(9 hours * 60) / 15 = 36 slots`

Every event becomes:

* `startSlot` (0–35)
* `slotCount` (duration / 15)

This is also how you prevent the “jumping around” bug: snapping becomes integer slot math.

---

### B. Title → Template mapping (the gatekeeper)

Prediction is impossible until imported titles reliably map to templates (or stay Unassigned).

Use a mapping layer that does:

1. exact match
2. alias match
3. fuzzy match only if unambiguous
4. else Unassigned

Store the mapping as a file (I give you the format below) so you can correct it once and reuse forever.

---

### C. Learn probability tables from past calendars (simple and strong)

From your uploaded calendars (ICS/CSV), compute counts and turn them into conditional probabilities.

Core probability you want:

**P(template | cohortType, campus, weekIndex, dayOfWeek, timeBucket)**

Where:

* `weekIndex`: 1–9 (your new reality)
* `dayOfWeek`: Mon–Sat
* `timeBucket`: Morning / Midday / Afternoon (or finer buckets like 15-min slot ranges)

Use Laplace smoothing so you don’t get zeros:

`P = (count + α) / (total + α * K)`

* α = 1 works fine
* K = number of templates

This gives you “what usually happens” by week/day/time based on actual history.

---

### D. Golden Rule constrained scheduler (budget-first, probability-second)

This is the engine. It fills the calendar while enforcing Golden Rule hours.

Inputs:

* Golden Rule budgets (minutes per template or per category)
* Meeting pattern (which days meet)
* Hard-locked events (OSHA, tours, speakers, etc.)
* Resource rules (Classroom 1/2/Shop conflicts)
* Learned probability table from section C

Steps:

1. Build empty 15-min grid for all cohort days/weeks.
2. Place all hard-locked events first.
3. Track remaining minutes for each Golden Rule bucket.
4. Fill remaining slots using a weighted choice:

Score a candidate placement like:
`score = w1 * P(template | context) + w2 * urgency(template) - w3 * conflictPenalty - w4 * fragmentationPenalty`

Where:

* `urgency(template) = remainingMinutes(template) / remainingDaysLeft`
* `conflictPenalty` is huge if resource collision
* `fragmentationPenalty` discourages nonsense like 15 minutes of a topic unless you explicitly allow it

Stop conditions:

* Never exceed Golden Rule minutes
* Never overlap resources
* Never schedule outside 06:30–15:30
* If a template can’t fit later, backtrack (see next section)

---

### E. Backtracking when you paint yourself into a corner (minimal but necessary)

Greedy-only schedulers get stuck.

Implement a light backtracking:

* If you can’t place remaining minutes for a bucket, rewind the last N placements and try alternatives.
* N can be small (10–30 placements) because this is structured data.

This prevents “everything ends up jammed into Week 9” behavior.

---

### F. Confidence + “ask before commit”

Every predicted block gets:

* `confidence = P(template | context)` (normalized 0–1)
* `reason`: top factors (week/day/time pattern + remaining budget pressure)

UI behavior:

* Show predicted blocks as “Suggested”
* User clicks “Accept all” or “Accept selected”
* Nothing commits until accepted (you asked for this)

---

### G. Multi-calendar comparison (resource collision solver)

You wanted: “If calendar 1 uses Classroom 1, calendar 2 must use Classroom 2.”

This is a straight interval-overlap problem on the same 15-min grid.

Algorithm:

1. For each calendar, build a set of occupied slots per resource:
   `occupied[resourceId][date][slot] = eventId`
2. Compare calendars:

   * collision if same `date + slot + resourceId` is occupied by both
3. Resolution suggestions:

   * if event has allowedResources = [C1, C2], auto-swap to free one
   * else propose nearest free time window of same length

This is deterministic. No guessing.

---

## 2) The data you should upload (so the predictor has real training input)

You need four uploadable files (plus your existing ICS calendars). These are simple CSV/JSON so Replit can parse them easily.

### File 1: `templates.csv` (your block library + Golden Rule budget links)

```csv
template_id,title,category,budget_minutes,default_duration_minutes,counts_toward_golden_rule,allowed_resources
workout,Work Out,Other,0,60,false,ANY
lunch,Lunch,Admin,0,60,false,ANY
osha10,OSHA 10,Certification,600,300,true,CLASSROOM_2
intro_preapp,Introduction to Pre-Apprenticeship,Professional Development,180,180,true,CLASSROOM_2
support_services,Support Services Intake and Intro,Support Services,90,90,true,CLASSROOM_2
aces_intro,Intro into ACES,Shop,240,120,true,SHOP
tape_intro,Intro to Tape Measure for ACES,Shop,120,60,true,SHOP
```

Notes:

* `budget_minutes` is the Golden Rule budget for that item.
* For topics that are tracked at a higher category level (like “Skills Project 42h”), either:

  * create a single template `skills_project` with 2520 minutes, OR
  * break it into sub-templates that still roll up to Skills Project.
    Your system already uses Golden Rule totals; this just makes it explicit for prediction.

---

### File 2: `title_aliases.csv` (stops import chaos; powers prediction)

```csv
raw_title,template_id,match_type,notes
Intro to Pre-Apprenticeship,intro_preapp,alias,
Introduction to Pre apprenticeship,intro_preapp,alias,
OSHA 10 Day 1,osha10,alias,
OSHA Day 2,osha10,alias,
Aces,aces_intro,alias,If you separate ACES later, split into more templates
Tape Measure Practice,tape_intro,alias,
```

Rules:

* App uses this first before fuzzy matching.
* If `raw_title` isn’t found here and isn’t an exact match to `templates.csv`, it becomes Unassigned.

---

### File 3: `resources.csv` (for comparison + collision detection)

```csv
resource_id,name,type
CLASSROOM_1,Classroom 1,room
CLASSROOM_2,Classroom 2,room
SHOP,Shop,shop
OFFSITE,Offsite,offsite
```

---

### File 4: `hard_events.csv` (locks the “known dates” first)

This is what you described: “If I know OSHA, mock weeks, forklift, flaggers, tours… I can schedule everything else around it.”

```csv
cohort_id,start_date,start_time,end_time,title,template_id,resource_id,locked,contact_name,contact_phone,contact_email,notes
PACE_XX,2026-02-04,06:30,11:30,OSHA 10 Day 1,osha10,CLASSROOM_2,true,,,,,
PACE_XX,2026-02-05,06:30,11:30,OSHA 10 Day 2,osha10,CLASSROOM_2,true,,,,,
PACE_XX,2026-02-10,09:00,13:00,Sheet Metal Local 66 Visit,,OFFSITE,true,Name,,,
```

Notes:

* `template_id` can be blank for custom events (tour/speaker) because they should not auto-count until you assign them.
* This is where you store contractor contact info tied to the event.

---

## 3) What you upload from your existing calendars

Upload what you already have:

* ICS files (PACE/TRP calendars)
* CSV export if you have it
* The mapping files above

The training pipeline should:

1. import ICS → events
2. map titles → template_id using `title_aliases.csv` + exact match
3. anything else → Unassigned (not counted)
4. build probability tables from the mapped history

---

## 4) Output format the predictor should generate (so it’s reviewable + explainable)

### `predicted_schedule.json`

```json
{
  "cohortId": "PACE_XX",
  "weeks": [
    {
      "weekIndex": 1,
      "days": [
        {
          "date": "2026-02-03",
          "events": [
            {
              "startTime": "06:30",
              "durationMinutes": 180,
              "templateId": "intro_preapp",
              "titleOverride": null,
              "resourceId": "CLASSROOM_2",
              "confidence": 0.78,
              "status": "suggested",
              "countsTowardGoldenRule": true,
              "why": "High historical frequency for Week 1 morning + remaining PD budget"
            }
          ]
        }
      ]
    }
  ]
}
```

This is exactly what enables “ask before commit.”

---

## 5) If you want the predictor to ask you questions first, here’s the minimum set

Do not overcomplicate intake. Ask only what changes predictions the most:

1. Cohort start date
2. Which days meet each week
3. Any locked dates (OSHA, forklift, flaggers, mock week, graduation)
4. Resource rules (Classroom 1/2/Shop availability constraints)
5. Any known tours/speakers (date/time/contact)

Everything else the model can propose.

---

If you want, paste back the current list of templates your app is actually using right now (the internal IDs, not just display text). I’ll rewrite `templates.csv` + `title_aliases.csv` so it matches your real library exactly, which is the difference between “predictive” and “random nonsense.”
